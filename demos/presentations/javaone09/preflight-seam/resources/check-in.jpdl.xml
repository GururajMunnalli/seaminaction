<?xml version="1.0" encoding="UTF-8"?>
<pageflow-definition
	xmlns="http://jboss.com/products/seam/pageflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://jboss.com/products/seam/pageflow
		http://jboss.com/products/seam/pageflow-2.0.xsd"
	name="check-in">

	<start-state name="begin">
		<transition name="begin" to="flights"/>
	</start-state>

	<page name="flights" view-id="/checkIn/flights.xhtml" redirect="true">
		<description>Flights and passengers - #{reservation.number}</description>
		<transition name="cancel" to="cancel"/>
		<transition name="continue" to="validateSelection">
			<action expression="#{checkInAssistant.selectBoardingPasses}"/>
		</transition>
	</page>

	<decision name="validateSelection" expression="#{boardingPasses.rowCount gt 0}">
		<transition name="false" to="flights"/>
		<transition name="true" to="declareBaggage"/>
	</decision>

	<page name="declareBaggage" view-id="/checkIn/declareBaggage.xhtml" redirect="true">
		<description>Baggage - #{reservation.number}</description>
		<transition name="cancel" to="cancel"/>
		<transition name="continue" to="confirmSeats"/>
	</page>

	<page name="confirmSeats" view-id="/checkIn/confirmSeats.xhtml" redirect="true">
		<description>Confirm seats - #{reservation.number}</description>
		<transition name="cancel" to="cancel"/>
		<transition name="continue" to="issueBoardingPass">
			<action expression="#{checkInAssistant.checkIn}"/>
		</transition>
	</page>

	<page name="issueBoardingPass" view-id="/checkIn/issueBoardingPass.xhtml" redirect="true">
		<description>Boarding pass options - #{reservation.number}</description>
		<transition name="cancel" to="cancel"/>
		<transition name="commit" to="summary">
			<action expression="#{checkInAssistant.commit}"/>
		</transition>
	</page>

	<page name="summary" view-id="/checkIn/summary.xhtml" redirect="true">
		<description>Check-in summary - #{reservation.number}</description>
		<transition name="exit" to="exit"/>
	</page>

	<page name="cancel" view-id="/start.xhtml" redirect="true">
		<end-conversation before-redirect="true"/>
	</page>

	<page name="exit" view-id="/home.xhtml" redirect="true">
		<end-conversation before-redirect="true"/>
	</page>

</pageflow-definition>
